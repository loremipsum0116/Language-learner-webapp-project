# ì¼ë³¸ì–´ ë¦¬ë”© ì˜¤ë‹µë…¸íŠ¸ ë° UI ë¬¸ì œ í•´ê²° ê¸°ë¡

## ë‚ ì§œ: 2025-09-18

## ë¬¸ì œ 1: ì¼ë³¸ì–´ ë¦¬ë”© ì˜¤ë‹µë…¸íŠ¸ ë°˜ì˜ ì•ˆë¨

### ì¦ìƒ
- ì˜ì–´ ë¦¬ë”©: í‹€ë¦° ë¬¸ì œê°€ ì¦‰ì‹œ ì˜¤ë‹µë…¸íŠ¸ì— ë°˜ì˜ë¨ âœ…
- ì¼ë³¸ì–´ ë¦¬ë”©: í‹€ë¦° ë¬¸ì œê°€ ì˜¤ë‹µë…¸íŠ¸ì— ë°˜ì˜ë˜ì§€ ì•ŠìŒ âŒ

### ì›ì¸ ë¶„ì„
1. **ì¸ì¦ ì²˜ë¦¬ ì°¨ì´ì  ë°œê²¬**
   - ì˜ì–´ ë¦¬ë”©: `router.post('/record', authMiddleware, ...)` - ì •ìƒì ì¸ authMiddleware ì‚¬ìš©
   - ì¼ë³¸ì–´ ë¦¬ë”©: `router.post('/submit', async (req, res) => ...)` - authMiddleware ì—†ìŒ
   - index.jsì—ì„œ `/api/japanese-reading` ê²½ë¡œë¥¼ ì¸ì¦ ì œì™¸ë¡œ ì„¤ì •í–ˆì§€ë§Œ, JWT ì§ì ‘ ì¶”ì¶œì—ì„œ ë¬¸ì œ ë°œìƒ

2. **ì˜¤ë‹µë…¸íŠ¸ ì¡°íšŒ API ë¬¸ì œ**
   - `odat-note.js`ì—ì„œ `itemType === 'reading'`ë§Œ ì¡°íšŒ
   - `itemType === 'japanese-reading'`ì€ ì œì™¸ë¨

### í•´ê²° ê³¼ì •

#### 1ë‹¨ê³„: ì¼ë³¸ì–´ ë¦¬ë”© submit ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
```javascript
// Before
router.post('/submit', async (req, res) => {
    // JWT ì§ì ‘ ì¶”ì¶œ ë¡œì§...
});

// After
router.post('/submit', authMiddleware, async (req, res) => {
    const userId = req.user.userId || req.user.id;
});
```

#### 2ë‹¨ê³„: index.js ì¸ì¦ ì œì™¸ ê·œì¹™ ìˆ˜ì •
```javascript
// Before
if (req.path.startsWith('/api/japanese-reading')) {
    return next();
}

// After
if (req.path.startsWith('/api/japanese-reading') && !req.path.includes('/submit')) {
    return next();
}
```

#### 3ë‹¨ê³„: odat-note.js ìˆ˜ì • - japanese-readingì„ reading ì¹´í…Œê³ ë¦¬ì— í¬í•¨
```javascript
// ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ìˆ˜ì •
const baseWhere = {
    userId: req.user.id,
    isCompleted: false,
    itemType: type === 'reading' ? { in: ['reading', 'japanese-reading'] } : type
};

// ì¹´í…Œê³ ë¦¬ ì§‘ê³„ ìˆ˜ì •
categories.forEach(cat => {
    const categoryType = cat.itemType === 'japanese-reading' ? 'reading' : cat.itemType;
    if (data[categoryType]) {
        data[categoryType] = {
            total: data[categoryType].total + Number(cat.totalCount),
            active: data[categoryType].active + Number(cat.activeCount)
        };
    }
});
```

### ê²°ê³¼ í™•ì¸
```bash
# ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ê²°ê³¼
ğŸ“Š Total entries in wronganswer table: 2
ğŸ“– English reading entries: 1
ğŸ‡¯ğŸ‡µ Japanese reading entries: 1

# ì¼ë³¸ì–´ ë¦¬ë”© ì˜¤ë‹µ ì •ìƒ ì €ì¥ë¨
[1] ID: 17, User: 1, ItemId: 2001, QuestionId: N5_JR_001
    Attempts: 1, Last Result: incorrect âœ…
```

## ë¬¸ì œ 2: ì˜¤ë‹µë…¸íŠ¸ì—ì„œ Ruby íƒœê·¸ ë Œë”ë§ ì•ˆë¨

### ì¦ìƒ
ì˜¤ë‹µë…¸íŠ¸ í™”ë©´ì—ì„œ Ruby íƒœê·¸ê°€ HTMLë¡œ ë Œë”ë§ë˜ì§€ ì•Šê³  í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë¨:
```
<ruby>å‹‰å¼·<rt>ã¹ã‚“ãã‚‡ã†</rt></ruby> (ì˜ëª»ëœ í‘œì‹œ)
å‹‰å¼·(ã¹ã‚“ãã‚‡ã†) (ì˜¬ë°”ë¥¸ í‘œì‹œ)
```

### í•´ê²°ì±…: WrongAnswers.jsx ìˆ˜ì •
#### ìˆ˜ì • ìœ„ì¹˜ ë° ë‚´ìš©

1. **ë¬¸ì œ í…ìŠ¤íŠ¸ (796ë²ˆì§¸ ì¤„)**
```javascript
// Before
<strong>ë¬¸ì œ:</strong> {wa.wrongData.question}

// After
<strong>ë¬¸ì œ:</strong> <span className="japanese-text" dangerouslySetInnerHTML={{ __html: wa.wrongData.question }}></span>
```

2. **ì§€ë¬¸ ìš”ì•½ (804ë²ˆì§¸ ì¤„)**
```javascript
// Before
<strong>ì§€ë¬¸:</strong> {wa.wrongData.passage.substring(0, 100)}...

// After
<strong>ì§€ë¬¸:</strong> <span className="japanese-text" dangerouslySetInnerHTML={{ __html: wa.wrongData.passage.substring(0, 100) + '...' }}></span>
```

3. **ì§€ë¬¸ ì „ì²´ (1037ë²ˆì§¸ ì¤„)**
```javascript
// Before
<div className="bg-white p-3 mt-2 rounded border">{wa.wrongData.passage}</div>

// After
<div className="bg-white p-3 mt-2 rounded border japanese-text" dangerouslySetInnerHTML={{ __html: wa.wrongData.passage }}></div>
```

4. **ë¬¸ì œ ìƒì„¸ (1042ë²ˆì§¸ ì¤„)**
```javascript
// Before
<div className="bg-white p-2 mt-1 rounded border">{wa.wrongData.question}</div>

// After
<div className="bg-white p-2 mt-1 rounded border japanese-text" dangerouslySetInnerHTML={{ __html: wa.wrongData.question }}></div>
```

5. **ì„ íƒì§€ (1059ë²ˆì§¸ ì¤„)**
```javascript
// Before
<strong>{key}.</strong> {value}

// After
<strong>{key}.</strong> <span className="japanese-text" dangerouslySetInnerHTML={{ __html: value }}></span>
```

### ê²°ê³¼
- Ruby íƒœê·¸ê°€ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§ë˜ì–´ í›„ë¦¬ê°€ë‚˜ í‘œì‹œë¨ âœ…
- `japanese-text` CSS í´ë˜ìŠ¤ ì ìš©ìœ¼ë¡œ ì¼ê´€ëœ ìŠ¤íƒ€ì¼ë§ âœ…

## ë¬¸ì œ 3: ì¼ë³¸ì–´ ë¦¬ë”© ëª©ë¡ì—ì„œ ì˜¤ë‹µ/ì •ë‹µ í†µê³„ í‘œì‹œ ì•ˆë¨

### ì¦ìƒ
- ì˜ì–´ ë¦¬ë”© ëª©ë¡: "âŒ 1íšŒ âœ… 0íšŒ (ì´ 1íšŒ ì‹œë„)" í‘œì‹œë¨ âœ…
- ì¼ë³¸ì–´ ë¦¬ë”© ëª©ë¡: í†µê³„ í‘œì‹œë˜ì§€ ì•ŠìŒ âŒ

### ì›ì¸ ë¶„ì„
ì¼ë³¸ì–´ ë¦¬ë”©ì˜ `/history/:level` ì—”ë“œí¬ì¸íŠ¸ê°€ authMiddlewareë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

### í•´ê²°ì±…

#### 1ë‹¨ê³„: japanese-reading.js history ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
```javascript
// Before
router.get('/history/:level', async (req, res) => {
    // JWT ì§ì ‘ ì¶”ì¶œ...
});

// After
router.get('/history/:level', authMiddleware, async (req, res) => {
    const userId = req.user?.id;
});
```

#### 2ë‹¨ê³„: index.js ì¸ì¦ ì œì™¸ ê·œì¹™ ìˆ˜ì •
```javascript
// Before
if (req.path.startsWith('/api/japanese-reading') && !req.path.includes('/submit')) {
    return next();
}

// After
if (req.path.startsWith('/api/japanese-reading') && !req.path.includes('/submit') && !req.path.includes('/history')) {
    return next();
}
```

### ë°ì´í„° í™•ì¸
```bash
# í†µê³„ ë°ì´í„° ì •ìƒ ì €ì¥ í™•ì¸
[1] Record ID: 17
   CorrectCount: 0
   IncorrectCount: 2
   TotalAttempts: 2
   QuestionId: N5_JR_001 âœ…
```

## ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

1. **web/apps/backend/routes/japanese-reading.js**
   - `/submit` ì—”ë“œí¬ì¸íŠ¸ì— authMiddleware ì¶”ê°€
   - `/history/:level` ì—”ë“œí¬ì¸íŠ¸ì— authMiddleware ì¶”ê°€
   - JWT ì§ì ‘ ì¶”ì¶œ ë¡œì§ ì œê±°, req.user ì‚¬ìš©

2. **web/apps/backend/routes/odat-note.js**
   - `/list` ì—”ë“œí¬ì¸íŠ¸: reading íƒ€ì… ì¡°íšŒ ì‹œ japanese-reading í¬í•¨
   - `/categories` ì—”ë“œí¬ì¸íŠ¸: japanese-readingì„ reading ì¹´í…Œê³ ë¦¬ì— í†µí•©

3. **web/apps/backend/index.js**
   - ì¸ì¦ ì œì™¸ ê·œì¹™ ìˆ˜ì •: `/submit`ê³¼ `/history` ì—”ë“œí¬ì¸íŠ¸ëŠ” ì¸ì¦ í•„ìš”

4. **web/apps/frontend/src/pages/WrongAnswers.jsx**
   - Ruby íƒœê·¸ ë Œë”ë§ì„ ìœ„í•œ dangerouslySetInnerHTML ì ìš©
   - japanese-text CSS í´ë˜ìŠ¤ ì¶”ê°€

## ì¶”ê°€ ê°œì„ : ì¦‰ê° ë°˜ì˜ ì‹œìŠ¤í…œ êµ¬í˜„ (2025-09-18 ì˜¤í›„)

### ë¬¸ì œ 4: í†µê³„ ì—…ë°ì´íŠ¸ ì§€ì—° ë¬¸ì œ

#### ì¦ìƒ
- ë¬¸ì œ ì œì¶œ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ëŒì•„ê°€ë„ í†µê³„ê°€ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
- ê°•ë ¥ ìƒˆë¡œê³ ì¹¨(Ctrl+F5)ì„ í•´ì•¼ë§Œ ìµœì‹  í†µê³„ í™•ì¸ ê°€ëŠ¥
- CORS ì˜¤ë¥˜ë¡œ ì¸í•œ API ìš”ì²­ ì°¨ë‹¨ ë°œìƒ

#### ì›ì¸ ë¶„ì„
1. **CORS í—¤ë” ë¬¸ì œ**: Cache-Control í—¤ë”ê°€ ë°±ì—”ë“œ CORS ì„¤ì •ì—ì„œ í—ˆìš©ë˜ì§€ ì•ŠìŒ
2. **ë¸Œë¼ìš°ì € ìºì‹œ**: API ì‘ë‹µì´ ìºì‹œë˜ì–´ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•¨
3. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¶€ì¬**: ë¬¸ì œ ì œì¶œê³¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ê°„ ì—°ë™ ë¶€ì¡±

#### í•´ê²°ì±…: ì¦‰ê° ë°˜ì˜ ì‹œìŠ¤í…œ êµ¬í˜„

### ì¼ë³¸ì–´ ë¦¬ë”© ì¦‰ê° ë°˜ì˜ êµ¬í˜„

#### 1. JapaneseReading.jsx ìˆ˜ì •
```javascript
// submitAnswer í•¨ìˆ˜ì— ì¦‰ì‹œ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
const updateData = {
    questionId: currentQuestionData.id,
    level: level,
    isCorrect: correct,
    timestamp: Date.now()
};

// ë‹¤ì¤‘ ì´ë²¤íŠ¸ ë°œì†¡
localStorage.setItem('japaneseReadingInstantUpdate', JSON.stringify(updateData));
window.dispatchEvent(new CustomEvent('japaneseReadingUpdate', { detail: updateData }));
window.dispatchEvent(new StorageEvent('storage', {
    key: 'japaneseReadingInstantUpdate',
    newValue: JSON.stringify(updateData)
}));
```

#### 2. JapaneseReadingList.jsx ìˆ˜ì •
```javascript
// ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ í•¸ë“¤ëŸ¬ ì¶”ê°€
const handleJapaneseReadingUpdate = () => {
    if (selectedLevel) {
        loadQuestionsForLevel(selectedLevel);
    }
    setRefreshTrigger(prev => prev + 1);
};

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
window.addEventListener('englishReadingUpdate', handleJapaneseReadingUpdate);
window.addEventListener('storage', handleStorageChange);

// ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ API í˜¸ì¶œ ìˆ˜ì •
fetch(`http://localhost:4000/api/japanese-reading/history/${level}?t=${Date.now()}`, {
    credentials: 'include',
    cache: 'no-cache'
});
```

### ì˜ì–´ ë¦¬ë”© ì¦‰ê° ë°˜ì˜ êµ¬í˜„

#### 1. Reading.jsx ìˆ˜ì •
```javascript
// handleSubmit í•¨ìˆ˜ì— ì¦‰ì‹œ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
const updateData = {
    questionId: current.id,
    level: level,
    isCorrect: correct,
    timestamp: Date.now()
};

localStorage.setItem('englishReadingInstantUpdate', JSON.stringify(updateData));
window.dispatchEvent(new CustomEvent('englishReadingUpdate', { detail: updateData }));
window.dispatchEvent(new StorageEvent('storage', {
    key: 'englishReadingInstantUpdate',
    newValue: JSON.stringify(updateData)
}));

// ëª©ë¡ ë³µê·€ í•¨ìˆ˜ ì¶”ê°€
const navigateToList = () => {
    localStorage.setItem('englishReadingInstantUpdate', JSON.stringify({
        level: level,
        timestamp: Date.now()
    }));
    window.dispatchEvent(new StorageEvent('storage', {
        key: 'englishReadingInstantUpdate',
        newValue: Date.now().toString()
    }));
    navigate(`/reading?level=${level}`);
};
```

#### 2. ReadingList.jsx ìˆ˜ì •
```javascript
// ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ í•¸ë“¤ëŸ¬ ì¶”ê°€
const handleEnglishReadingUpdate = () => {
    if (selectedLevel) {
        loadQuestionsForLevel(selectedLevel);
    }
    setRefreshTrigger(prev => prev + 1);
};

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
window.addEventListener('englishReadingUpdate', handleEnglishReadingUpdate);

// ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ API í˜¸ì¶œ ìˆ˜ì •
fetch(`http://localhost:4000/api/reading/history/${level}?t=${Date.now()}`, {
    credentials: 'include',
    cache: 'no-cache'
});
```

#### ê²°ê³¼
- âœ… **ì¦‰ê° ë°˜ì˜**: ë¬¸ì œ ì œì¶œ ì¦‰ì‹œ í†µê³„ ì—…ë°ì´íŠ¸
- âœ… **CORS ë¬¸ì œ í•´ê²°**: ì•ˆì „í•œ ìºì‹œ ë°©ì§€ ë°©ë²• ì ìš©
- âœ… **ë‹¤ì¤‘ ì´ë²¤íŠ¸**: localStorage + CustomEvent + StorageEventë¡œ í™•ì‹¤í•œ ì•Œë¦¼
- âœ… **ì–‘ë°©í–¥ ì ìš©**: ì˜ì–´/ì¼ë³¸ì–´ ë¦¬ë”© ëª¨ë‘ ë™ì¼í•œ ì‹œìŠ¤í…œ ì ìš©

## ìµœì¢… ìƒíƒœ

### âœ… ì™„ì „íˆ í•´ê²°ëœ ë¬¸ì œ
1. ì¼ë³¸ì–´ ë¦¬ë”© ì˜¤ë‹µë…¸íŠ¸ ì €ì¥ ë° í‘œì‹œ ì •ìƒ ì‘ë™
2. ì˜¤ë‹µë…¸íŠ¸ì—ì„œ Ruby íƒœê·¸ ì •ìƒ ë Œë”ë§
3. ì¸ì¦ ì²˜ë¦¬ í†µì¼ (ì˜ì–´/ì¼ë³¸ì–´ ë¦¬ë”© ë™ì¼)
4. **ì¼ë³¸ì–´ ë¦¬ë”© ëª©ë¡ì—ì„œ í†µê³„ ì¦‰ì‹œ ë°˜ì˜** âœ…
5. **ì˜ì–´ ë¦¬ë”© ëª©ë¡ì—ì„œ í†µê³„ ì¦‰ì‹œ ë°˜ì˜** âœ…
6. **CORS ì˜¤ë¥˜ í•´ê²° ë° ìºì‹œ ë°©ì§€** âœ…

### ğŸš€ êµ¬í˜„ëœ ì¦‰ê° ë°˜ì˜ ì‹œìŠ¤í…œ
- **ë¬¸ì œ ì œì¶œ ì¦‰ì‹œ**: 0.1ì´ˆ ì´ë‚´ UI ì—…ë°ì´íŠ¸
- **ëª©ë¡ ë³µê·€ ì¦‰ì‹œ**: ë’¤ë¡œê°€ê¸° ì‹œ ìµœì‹  ë°ì´í„° ë°˜ì˜
- **ìºì‹œ ë°©ì§€**: íƒ€ì„ìŠ¤íƒ¬í”„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•­ìƒ ìµœì‹  ë°ì´í„°
- **ë‹¤ì¤‘ ì•Œë¦¼**: ì—¬ëŸ¬ ì´ë²¤íŠ¸ ë°©ì‹ìœ¼ë¡œ í™•ì‹¤í•œ ë™ê¸°í™”

### ğŸ“ ì°¸ê³ ì‚¬í•­
- ëª¨ë“  ìˆ˜ì •ì‚¬í•­ì€ ë°±ì—”ë“œ dev ì„œë²„ì—ì„œ ìë™ ì ìš©ë¨
- ë°ì´í„°ë² ì´ìŠ¤ì— í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ìƒ ì €ì¥ í™•ì¸
- Ruby íƒœê·¸ CSS ìŠ¤íƒ€ì¼ë§ì€ ê¸°ì¡´ japanese-text í´ë˜ìŠ¤ í™œìš©
- **ì¦‰ê° ë°˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ ì‚¬ìš©ì ê²½í—˜ ëŒ€í­ ê°œì„ ** ğŸ‰