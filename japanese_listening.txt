# ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ í†µê³„ ë° ì˜¤ë‹µë…¸íŠ¸ ê¸°ëŠ¥ êµ¬í˜„ ì§„í–‰ì‚¬í•­

## ğŸ“‹ ì‘ì—… ê°œìš”
- **ëª©í‘œ**: ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ë¬¸ì œì— ëŒ€í•œ í†µê³„ ê¸°ë¡ ë° ì˜¤ë‹µë…¸íŠ¸ ê¸°ëŠ¥ êµ¬í˜„
- **ë¬¸ì œ**: ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ë¬¸ì œë¥¼ í’€ì–´ë„ í†µê³„ê°€ ê¸°ë¡ë˜ì§€ ì•Šê³ , ì˜¤ë‹µë…¸íŠ¸ì—ë„ ì €ì¥ë˜ì§€ ì•ŠìŒ
- **ì‹œì‘ ì‹œê°„**: 2025-09-23 16:31 (KST)

## ğŸ” ë¬¸ì œ ë¶„ì„ ê²°ê³¼
1. **ê¸°ì¡´ êµ¬ì¡°**: ListeningQuiz ì»´í¬ë„ŒíŠ¸ê°€ ì˜ì–´ ë¦¬ìŠ¤ë‹ìš©ìœ¼ë¡œë§Œ êµ¬í˜„ë¨
2. **ëˆ„ë½ëœ ê¸°ëŠ¥**: ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ì „ìš© API ì—”ë“œí¬ì¸íŠ¸ ë¶€ì¬
3. **í†µê³„ ì‹œìŠ¤í…œ**: ì˜ì–´ ë¦¬ìŠ¤ë‹ê³¼ ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ì˜ êµ¬ë¶„ í•„ìš”

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ë°±ì—”ë“œ êµ¬í˜„ (ì™„ë£Œ)
#### íŒŒì¼: `/web/apps/backend/routes/japanese-listening.js` (ì‹ ê·œ ìƒì„±)
- **ê¸°ëŠ¥**: ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ì „ìš© API ë¼ìš°íŠ¸
- **ì—”ë“œí¬ì¸íŠ¸**:
  - `POST /api/japanese-listening/submit`: ë‹µì•ˆ ì œì¶œ ë° í†µê³„ ê¸°ë¡
  - `GET /api/japanese-listening/history/:level`: ë ˆë²¨ë³„ í•™ìŠµ ê¸°ë¡ ì¡°íšŒ
- **íŠ¹ì§•**:
  - ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ì€ 7000ë²ˆëŒ€ itemId ì‚¬ìš© (ì˜ì–´ ë¦¬ìŠ¤ë‹ê³¼ êµ¬ë¶„)
  - `japanese-listening` itemTypeìœ¼ë¡œ wronganswer í…Œì´ë¸”ì— ì €ì¥
  - ëˆ„ì  í†µê³„ ê´€ë¦¬ (ì •ë‹µ/ì˜¤ë‹µ íšŸìˆ˜, ì´ ì‹œë„ íšŸìˆ˜)
  - ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì ìš©

#### íŒŒì¼: `/web/apps/backend/index.js` (ìˆ˜ì •)
- **ë³€ê²½ì‚¬í•­**:
  ```javascript
  const japaneseListeningRoutes = require('./routes/japanese-listening');
  app.use('/api/japanese-listening', japaneseListeningRoutes);
  ```
- **ìƒíƒœ**: ë¼ìš°íŠ¸ ì •ìƒ ë“±ë¡ í™•ì¸ë¨

### 2. í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ (ì™„ë£Œ)
#### íŒŒì¼: `/web/apps/frontend/src/components/ListeningQuiz.jsx` (ìˆ˜ì •)
- **ì£¼ìš” ë³€ê²½ì‚¬í•­**:
  - `isJapanese` prop ì¶”ê°€ (ê¸°ë³¸ê°’: false)
  - ì¼ë³¸ì–´/ì˜ì–´ ë¦¬ìŠ¤ë‹ êµ¬ë¶„ ë¡œì§ êµ¬í˜„
  - ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ìš© API í˜¸ì¶œ ë¡œì§ ì¶”ê°€
  - ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ë¶„ë¦¬ (ì˜ì–´: englishListeningUpdate, ì¼ë³¸ì–´: japaneseListeningUpdate)
  - ì˜¤ë‹µë…¸íŠ¸ ê¸°ë¡ ë¡œì§ ìˆ˜ì • (ì¼ë³¸ì–´ëŠ” ìƒˆ APIì—ì„œ ì²˜ë¦¬, ì˜ì–´ëŠ” ê¸°ì¡´ ë°©ì‹ ìœ ì§€)

#### íŒŒì¼: `/web/apps/frontend/src/pages/JapaneseListening.jsx` (ìˆ˜ì •)
- **ë³€ê²½ì‚¬í•­**:
  ```javascript
  <ListeningQuiz
    questions={selectedQuestions}
    onComplete={handleQuizComplete}
    level={level}
    isJapanese={true}  // ì¶”ê°€ë¨
  />
  ```

#### íŒŒì¼: `/web/apps/frontend/src/pages/JapaneseListeningList.jsx` (ìˆ˜ì •)
- **ë³€ê²½ì‚¬í•­**:
  - API ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½: `/api/listening/history/${level}` â†’ `/api/japanese-listening/history/${level}`
  - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë³€ê²½: ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ì „ìš© ì´ë²¤íŠ¸ ì²˜ë¦¬
  - localStorage í‚¤ ë³€ê²½: `japaneseListeningInstantUpdate`, `japaneseListeningUpdated`

### 3. ë°ì´í„° íë¦„ ì„¤ê³„ (ì™„ë£Œ)
```
ì‚¬ìš©ì ë‹µì•ˆ ì œì¶œ
    â†“
ListeningQuiz (isJapanese=true)
    â†“
/api/japanese-listening/submit (POST)
    â†“
wronganswer í…Œì´ë¸” ì €ì¥ (itemType: 'japanese-listening', itemId: 7000+)
    â†“
ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ë°œì†¡ (japaneseListeningUpdate)
    â†“
JapaneseListeningList ìë™ ìƒˆë¡œê³ ì¹¨
```

## ğŸ”§ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸ (âœ… ì„±ê³µ)
```bash
curl -X GET "http://localhost:4000/api/japanese-listening/history/N3"
# ê²°ê³¼: {"ok":false,"error":"Unauthorized","code":"NO_TOKEN"}
# â†’ API ì ‘ê·¼ ì„±ê³µ, ì¸ì¦ í•„ìš” (ì •ìƒ)
```

### ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸ (âœ… ì„±ê³µ)
```
ğŸŒŸ [JAPANESE LISTENING ROUTES] Japanese listening routes file loaded!
ğŸŒŸ [JAPANESE LISTENING ROUTES] /history/:level route registered!
ğŸ”—ğŸš¨ [JAPANESE LISTENING ROUTER] GET /history/N3 - ACCESSED!
[AUTH] Checking request to: /history/N3 method: GET
[AUTH] No access token found, blocking request to: /history/N3
```

## âœ… ë¬¸ì œ í•´ê²° ì™„ë£Œ!

### í•´ê²°ëœ ë¬¸ì œ
**ì›ì¸**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `/api/japanese-listening/record` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ, ë°±ì—”ë“œì—ëŠ” `/api/japanese-listening/submit` ì—”ë“œí¬ì¸íŠ¸ë§Œ êµ¬í˜„ë˜ì–´ ìˆì—ˆìŒ

**í•´ê²°ë°©ë²•**: ë°±ì—”ë“œì— `/api/japanese-listening/record` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€ (ê¸°ì¡´ `/submit` ì—”ë“œí¬ì¸íŠ¸ì™€ ë™ì¼í•œ ê¸°ëŠ¥)

### ìµœì¢… í™•ì¸ëœ ì‚¬í•­
1. âœ… ë°±ì—”ë“œ ë¼ìš°íŠ¸ ì •ìƒ ë™ì‘
2. âœ… `/api/japanese-listening/record` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ ì™„ë£Œ
3. âœ… API ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ê°€ëŠ¥ (404 ì—ëŸ¬ í•´ê²°ë¨)
4. âœ… ì¸ì¦ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
5. âœ… í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ìˆ˜ì • ì™„ë£Œ

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
- **ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸**: `curl -X POST http://localhost:4000/api/japanese-listening/record` â†’ ì •ìƒ ì‘ë‹µ (ì¸ì¦ ì˜¤ë¥˜ëŠ” ì •ìƒ)
- **404 ì—ëŸ¬**: í•´ê²°ë¨
- **API ë¼ìš°íŒ…**: ì •ìƒ ì‘ë™

### ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€ (ì™„ë£Œ)
```javascript
// ListeningQuiz.jsxì— ì¶”ê°€ë¨
console.log(`ğŸš¨ğŸš¨ğŸš¨ [ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹] ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ëª¨ë“œì—ì„œ ë‹µì•ˆ ì²˜ë¦¬ ì‹œì‘!`);
console.log(`ğŸ“ [ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹] questionId: ${currentQuestion.id}, level: ${level}, isCorrect: ${isCorrect}`);
console.log(`ğŸš€ [ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹] API í˜¸ì¶œ ì‹œì‘: /api/japanese-listening/submit`);
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

### ì‹ ê·œ ìƒì„± íŒŒì¼
```
web/apps/backend/routes/japanese-listening.js
```

### ìˆ˜ì •ëœ íŒŒì¼
```
web/apps/backend/index.js
web/apps/frontend/src/components/ListeningQuiz.jsx
web/apps/frontend/src/pages/JapaneseListening.jsx
web/apps/frontend/src/pages/JapaneseListeningList.jsx
```

## âœ… ë‹¤ìŒ ë‹¨ê³„ (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ê¶Œì¥)

1. **ë¸Œë¼ìš°ì €ì—ì„œ ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ë¬¸ì œ í’€ê¸°**
   - URL: http://localhost:3000/japanese-listening?level=N3
   - ê°œë°œì ë„êµ¬ â†’ ì½˜ì†” íƒ­ì—ì„œ ë¡œê·¸ í™•ì¸
   - ì˜ˆìƒ ë¡œê·¸: `ğŸš¨ğŸš¨ğŸš¨ [JAPANESE LISTENING RECORD] API CALLED (alias for /submit)! ğŸš¨ğŸš¨ğŸš¨`

2. **ë„¤íŠ¸ì›Œí¬ ìš”ì²­ í™•ì¸**
   - ê°œë°œì ë„êµ¬ â†’ ë„¤íŠ¸ì›Œí¬ íƒ­
   - ë‹µì•ˆ ì œì¶œ ì‹œ `/api/japanese-listening/record` ìš”ì²­ ë°œìƒ í™•ì¸
   - ì‘ë‹µ ìƒíƒœ: 401 (ì¸ì¦ ì˜¤ë¥˜) ëŒ€ì‹  200 (ì„±ê³µ) ì˜ˆìƒ

3. **ì •ìƒ ì‘ë™ í™•ì¸ ì‚¬í•­**
   - âœ… 404 ì—ëŸ¬ í•´ê²°ë¨
   - âœ… API ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ì¸ì‹
   - ğŸ“ ì˜¤ë‹µë…¸íŠ¸ ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê¶Œì¥
   - ğŸ“ í†µê³„ ê¸°ë¡ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê¶Œì¥

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### wronganswer í…Œì´ë¸” ì‚¬ìš©
```sql
-- ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ê¸°ë¡ ì˜ˆì‹œ
itemType: 'japanese-listening'
itemId: 7001 (N3_L_001 â†’ 001 + 7000)
userId: [ì‚¬ìš©ì ID]
attempts: [ì‹œë„ íšŸìˆ˜]
wrongAt: [ë§ˆì§€ë§‰ í•™ìŠµ ì‹œê°„]
wrongData: {
  questionId: 'N3_L_001',
  level: 'N3',
  isCorrect: false,
  userAnswer: 'A',
  correctAnswer: 'B',
  question: 'ì§ˆë¬¸ ë‚´ìš©',
  script: 'ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©',
  topic: 'ì£¼ì œ',
  options: {...},
  audioFile: 'N3_Listening_mix/N3_L_001.mp3',
  correctCount: 0,
  incorrectCount: 1,
  totalAttempts: 1,
  lastResult: 'incorrect'
}
```

## ğŸ¯ ì„±ê³µ ê¸°ì¤€
1. ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ë¬¸ì œë¥¼ í’€ì—ˆì„ ë•Œ ë¸Œë¼ìš°ì € ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥
2. `/api/japanese-listening/submit` API í˜¸ì¶œ ë°œìƒ
3. wronganswer í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥
4. JapaneseListeningListì—ì„œ í†µê³„ í‘œì‹œ
5. ì˜¤ë‹µë…¸íŠ¸ì— í‹€ë¦° ë¬¸ì œ ê¸°ë¡

---
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-09-23 16:48 (KST)
**ìƒíƒœ**: âœ… 404 ì—ëŸ¬ í•´ê²° ì™„ë£Œ - `/api/japanese-listening/record` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ë¨
**ë‹¤ìŒ ì‘ì—…**: ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤ì œ ì¼ë³¸ì–´ ë¦¬ìŠ¤ë‹ ë¬¸ì œ í’€ì–´ë³´ê¸° ë° ê¸°ëŠ¥ í™•ì¸